'<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Lista de Compras</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; background-color: #000000; color: #ffffff; line-height: 1.6; min-height: 100vh; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; min-height: 100vh; }
        header { text-align: center; margin-bottom: 30px; }
        header h1 { font-size: 2.5rem; color: #ffffff; text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.1); }
        .add-item-section { margin-bottom: 30px; }
        .input-group { display: flex; gap: 10px; flex-wrap: wrap; }
        #itemInput { flex: 1; min-width: 200px; padding: 15px; font-size: 16px; border: 2px solid #333333; border-radius: 8px; background-color: #1a1a1a; color: #ffffff; transition: border-color 0.3s ease; }
        #priceInput { flex: 0.5; min-width: 120px; padding: 15px; font-size: 16px; border: 2px solid #333333; border-radius: 8px; background-color: #1a1a1a; color: #ffffff; transition: border-color 0.3s ease; }
        #itemInput:focus { outline: none; border-color: #4CAF50; box-shadow: 0 0 10px rgba(76, 175, 80, 0.3); }
        #itemInput::placeholder { color: #888888; }
        #addButton { padding: 15px 25px; font-size: 16px; font-weight: bold; background-color: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.3s ease; min-width: 120px; -webkit-tap-highlight-color: transparent; touch-action: manipulation; -webkit-user-select: none; user-select: none; }
        #addButton:hover { background-color: #45a049; }
        #addButton:active { transform: translateY(1px); }
        .price-search-section { margin-top: 15px; text-align: center; }
        .btn-price-search { padding: 10px 20px; font-size: 14px; background-color: #2196F3; color: white; border: none; border-radius: 6px; cursor: pointer; transition: background-color 0.3s ease; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        .btn-price-search:hover { background-color: #1976D2; }
        .price-results { margin-top: 10px; padding: 10px; background-color: #1a1a1a; border-radius: 6px; display: none; }
        .price-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #333; }
        .price-item:last-child { border-bottom: none; }
        .price-store { font-weight: bold; color: #4CAF50; }
        .price-value { color: #ffffff; }
        .list-section { margin-bottom: 30px; overflow-x: auto; }
        #shoppingList { width: 100%; border-collapse: collapse; background-color: #1a1a1a; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1); }
        #shoppingList th { background-color: #333333; color: #ffffff; padding: 15px; text-align: left; font-weight: bold; font-size: 16px; }
        #shoppingList td { padding: 15px; border-bottom: 1px solid #333333; vertical-align: middle; }
        #shoppingList tbody tr:hover { background-color: #2a2a2a; }
        #shoppingList tbody tr:last-child td { border-bottom: none; }
        .item-name { font-size: 16px; font-weight: 500; }
        .item-name.completed { text-decoration: line-through; color: #888888; }
        .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; text-transform: uppercase; }
        .status-badge.pending { background-color: #ff9800; color: white; }
        .status-badge.completed { background-color: #4CAF50; color: white; }
        .action-buttons { display: flex; gap: 8px; flex-wrap: wrap; }
        .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: bold; transition: all 0.3s ease; min-width: 80px; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        .btn-complete { background-color: #4CAF50; color: white; }
        .btn-complete:hover { background-color: #45a049; }
        .btn-complete:disabled { background-color: #666666; cursor: not-allowed; }
        .btn-remove { background-color: #f44336; color: white; }
        .btn-remove:hover { background-color: #da190b; }
        .btn-clear { padding: 8px 16px; background-color: #ff5722; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; transition: background-color 0.3s ease; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        .btn-clear:hover { background-color: #e64a19; }
        .stats { background-color: #1a1a1a; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1); }
        .stats p { margin: 10px 0; font-size: 16px; font-weight: 500; }
        .stats span { color: #4CAF50; font-weight: bold; font-size: 18px; }
        @media (max-width: 768px) {
            .container { padding: 15px; }
            header h1 { font-size: 2rem; }
            .input-group { flex-direction: column; }
            #itemInput { min-width: auto; width: 100%; }
            #addButton { width: 100%; }
            #shoppingList { font-size: 14px; }
            #shoppingList th, #shoppingList td { padding: 10px 8px; }
            .action-buttons { flex-direction: column; gap: 5px; }
            .btn { width: 100%; min-width: auto; }
        }
        @media (max-width: 480px) {
            .container { padding: 10px; }
            header h1 { font-size: 1.8rem; }
            #shoppingList th, #shoppingList td { padding: 8px 5px; font-size: 13px; }
            .item-name { font-size: 14px; }
            .btn { padding: 6px 12px; font-size: 12px; }
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        #shoppingList tbody tr { animation: fadeIn 0.3s ease; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #4CAF50; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #45a049; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üõí Lista de Compras</h1>
        </header>
        
        <div class="add-item-section">
            <div class="input-group">
                <input type="text" id="itemInput" placeholder="Digite o item para adicionar..." maxlength="50">
                <input type="number" id="priceInput" placeholder="Pre√ßo (opcional)" step="0.01" min="0">
                <button id="addButton">Adicionar</button>
            </div>
            <div class="price-search-section">
                <button id="searchPriceButton" class="btn-price-search">üîç Buscar Pre√ßos Online</button>
                <div id="priceResults" class="price-results"></div>
            </div>
        </div>
        
        <div class="list-section">
            <table id="shoppingList">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Pre√ßo</th>
                        <th>Status</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="listBody">
                </tbody>
            </table>
        </div>
        
        <div class="stats">
            <p>Total de itens: <span id="totalItems">0</span></p>
            <p>Itens comprados: <span id="purchasedItems">0</span></p>
            <p>Valor total estimado: <span id="totalPrice">¬£0.00</span></p>
            <p>Valor comprado: <span id="purchasedPrice">¬£0.00</span></p>
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #333;">
                <p style="font-size: 12px; color: #888;">Sess√£o: <span id="sessionId">Carregando...</span></p>
                <button id="clearDataButton" class="btn-clear" style="margin-top: 10px;">üóëÔ∏è Limpar Minha Lista</button>
            </div>
        </div>
    </div>
    
    <script>
        let shoppingList = [];
        let sessionId = null;
        
        document.addEventListener("DOMContentLoaded", function() {
            console.log("App carregado!");
            initializeSession();
            loadFromLocalStorage();
            updateStats();
            
            const itemInput = document.getElementById("itemInput");
            const addButton = document.getElementById("addButton");
            
            // Evento de teclado
            itemInput.addEventListener("keypress", function(e) {
                if (e.key === "Enter") {
                    console.log("Enter pressionado");
                    addItem();
                }
            });
            
            // Busca autom√°tica de pre√ßos quando o usu√°rio para de digitar
            let searchTimeout;
            itemInput.addEventListener("input", function() {
                clearTimeout(searchTimeout);
                const itemName = this.value.trim();
                
                if (itemName.length >= 3) { // Buscar apenas se tiver pelo menos 3 caracteres
                    searchTimeout = setTimeout(() => {
                        autoSearchPrice(itemName);
                    }, 1000); // Aguardar 1 segundo ap√≥s parar de digitar
                } else {
                    // Limpar resultados se o campo estiver vazio
                    document.getElementById("priceResults").style.display = 'none';
                }
            });
            
            // Eventos de toque para mobile
            addButton.addEventListener("click", function(e) {
                console.log("Bot√£o clicado!");
                e.preventDefault();
                e.stopPropagation();
                addItem();
            });
            
            addButton.addEventListener("touchend", function(e) {
                console.log("Toque no bot√£o!");
                e.preventDefault();
                e.stopPropagation();
                addItem();
            });
            
            // Evento adicional para iOS
            addButton.addEventListener("touchstart", function(e) {
                console.log("Touch start no bot√£o!");
                e.preventDefault();
            });
            
            // Prevenir zoom duplo toque
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            
            // Evento para busca de pre√ßos
            document.getElementById("searchPriceButton").addEventListener("click", function() {
                const itemName = document.getElementById("itemInput").value.trim();
                if (itemName) {
                    searchPrices(itemName);
                } else {
                    alert("Digite um item primeiro para buscar pre√ßos!");
                }
            });
            
            // Evento para limpar dados
            document.getElementById("clearDataButton").addEventListener("click", function() {
                if (confirm("Tem certeza que deseja limpar TODA a sua lista de compras? Esta a√ß√£o n√£o pode ser desfeita.")) {
                    clearAllData();
                }
            });
        });
        
        function addItem() {
            console.log("Fun√ß√£o addItem chamada");
            const input = document.getElementById("itemInput");
            const priceInput = document.getElementById("priceInput");
            const itemName = input.value.trim();
            const price = parseFloat(priceInput.value) || 0;
            
            console.log("Item digitado:", itemName, "Pre√ßo:", price);
            
            if (itemName === "") {
                console.log("Item vazio");
                alert("Por favor, digite um item para adicionar!");
                input.focus();
                return;
            }
            
            if (shoppingList.some(item => item.name.toLowerCase() === itemName.toLowerCase())) {
                console.log("Item j√° existe");
                alert("Este item j√° est√° na lista!");
                input.focus();
                return;
            }
            
            const newItem = {
                id: Date.now(),
                name: itemName,
                price: price,
                completed: false,
                dateAdded: new Date().toLocaleDateString("pt-BR")
            };
            
            console.log("Adicionando item:", newItem);
            shoppingList.push(newItem);
            input.value = "";
            priceInput.value = "";
            input.focus();
            
            renderList();
            updateStats();
            saveToLocalStorage();
            showNotification("Item adicionado com sucesso!", "success");
            console.log("Item adicionado com sucesso");
        }
        
        function renderList() {
            const tbody = document.getElementById("listBody");
            tbody.innerHTML = "";
            
            if (shoppingList.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; color: #888; padding: 30px;">
                            Nenhum item na lista ainda. Adicione seu primeiro item!
                        </td>
                    </tr>
                `;
                return;
            }
            
            const sortedList = [...shoppingList].sort((a, b) => {
                if (a.completed === b.completed) {
                    return a.name.localeCompare(b.name);
                }
                return a.completed - b.completed;
            });
            
            sortedList.forEach(item => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>
                        <span class="item-name ${item.completed ? "completed" : ""}">
                            ${item.name}
                        </span>
                    </td>
                    <td>
                        <span class="price-display">
                            ${item.price > 0 ? `¬£${item.price.toFixed(2)}` : 'N/A'}
                        </span>
                    </td>
                    <td>
                        <span class="status-badge ${item.completed ? "completed" : "pending"}">
                            ${item.completed ? "Comprado" : "Pendente"}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-complete" 
                                    onclick="toggleComplete(${item.id})"
                                    ${item.completed ? "disabled" : ""}>
                                ${item.completed ? "‚úì Comprado" : "Marcar como Comprado"}
                            </button>
                            <button class="btn btn-remove" onclick="removeItem(${item.id})">
                                Remover
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function toggleComplete(itemId) {
            const item = shoppingList.find(item => item.id === itemId);
            if (item) {
                item.completed = !item.completed;
                item.dateCompleted = item.completed ? new Date().toLocaleDateString("pt-BR") : null;
                
                renderList();
                updateStats();
                saveToLocalStorage();
                
                const message = item.completed ? 
                    "Item marcado como comprado!" : 
                    "Item marcado como pendente!";
                showNotification(message, "info");
            }
        }
        
        function removeItem(itemId) {
            const item = shoppingList.find(item => item.id === itemId);
            if (item && confirm(`Tem certeza que deseja remover "${item.name}" da lista?`)) {
                shoppingList = shoppingList.filter(item => item.id !== itemId);
                
                renderList();
                updateStats();
                saveToLocalStorage();
                
                showNotification("Item removido da lista!", "warning");
            }
        }
        
        function updateStats() {
            const totalItems = shoppingList.length;
            const purchasedItems = shoppingList.filter(item => item.completed).length;
            const totalPrice = shoppingList.reduce((sum, item) => sum + (item.price || 0), 0);
            const purchasedPrice = shoppingList
                .filter(item => item.completed)
                .reduce((sum, item) => sum + (item.price || 0), 0);
            
            document.getElementById("totalItems").textContent = totalItems;
            document.getElementById("purchasedItems").textContent = purchasedItems;
            document.getElementById("totalPrice").textContent = `¬£${totalPrice.toFixed(2)}`;
            document.getElementById("purchasedPrice").textContent = `¬£${purchasedPrice.toFixed(2)}`;
        }
        
        function saveToLocalStorage() {
            try {
                const key = `shoppingList_${sessionId}`;
                localStorage.setItem(key, JSON.stringify(shoppingList));
            } catch (error) {
                console.error("Erro ao salvar no localStorage:", error);
                showNotification("Erro ao salvar dados localmente", "error");
            }
        }
        
        function loadFromLocalStorage() {
            try {
                const key = `shoppingList_${sessionId}`;
                const saved = localStorage.getItem(key);
                if (saved) {
                    shoppingList = JSON.parse(saved);
                    renderList();
                }
            } catch (error) {
                console.error("Erro ao carregar do localStorage:", error);
                showNotification("Erro ao carregar dados salvos", "error");
            }
        }
        
        function showNotification(message, type = "info") {
            const existingNotification = document.querySelector(".notification");
            if (existingNotification) {
                existingNotification.remove();
            }
            
            const notification = document.createElement("div");
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                animation: slideIn 0.3s ease;
                max-width: 300px;
                word-wrap: break-word;
            `;
            
            const colors = {
                success: "#4CAF50",
                error: "#f44336",
                warning: "#ff9800",
                info: "#2196F3"
            };
            
            notification.style.backgroundColor = colors[type] || colors.info;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = "slideOut 0.3s ease";
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }
        
        const style = document.createElement("style");
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // Banco de dados expandido de pre√ßos m√©dios (baseado em pre√ßos UK)
        const priceDatabase = {
            // Latic√≠nios
            "leite": { asda: 0.89, tesco: 0.95, sainsburys: 0.92, morrisons: 0.88, names: ["leite", "milk", "lait"] },
            "manteiga": { asda: 1.50, tesco: 1.55, sainsburys: 1.52, morrisons: 1.48, names: ["manteiga", "butter", "beurre"] },
            "queijo": { asda: 2.20, tesco: 2.30, sainsburys: 2.25, morrisons: 2.18, names: ["queijo", "cheese", "fromage"] },
            "iogurte": { asda: 0.75, tesco: 0.80, sainsburys: 0.78, morrisons: 0.73, names: ["iogurte", "yogurt", "yaourt"] },
            "creme": { asda: 1.20, tesco: 1.25, sainsburys: 1.22, morrisons: 1.18, names: ["creme", "cream", "cr√®me"] },
            
            // P√£es e Cereais
            "p√£o": { asda: 0.45, tesco: 0.50, sainsburys: 0.48, morrisons: 0.46, names: ["p√£o", "bread", "pain"] },
            "cereal": { asda: 2.50, tesco: 2.60, sainsburys: 2.55, morrisons: 2.48, names: ["cereal", "cereais", "c√©r√©ales"] },
            "aveia": { asda: 1.80, tesco: 1.85, sainsburys: 1.82, morrisons: 1.78, names: ["aveia", "oats", "avoine"] },
            
            // Prote√≠nas
            "ovos": { asda: 1.20, tesco: 1.25, sainsburys: 1.22, morrisons: 1.18, names: ["ovos", "eggs", "≈ìufs"] },
            "frango": { asda: 3.50, tesco: 3.60, sainsburys: 3.55, morrisons: 3.45, names: ["frango", "chicken", "poulet"] },
            "carne": { asda: 4.20, tesco: 4.30, sainsburys: 4.25, morrisons: 4.15, names: ["carne", "beef", "viande"] },
            "porco": { asda: 3.80, tesco: 3.90, sainsburys: 3.85, morrisons: 3.75, names: ["porco", "pork", "porc"] },
            "peixe": { asda: 3.80, tesco: 3.90, sainsburys: 3.85, morrisons: 3.75, names: ["peixe", "fish", "poisson"] },
            "salm√£o": { asda: 6.50, tesco: 6.60, sainsburys: 6.55, morrisons: 6.45, names: ["salm√£o", "salmon", "saumon"] },
            "atum": { asda: 1.20, tesco: 1.25, sainsburys: 1.22, morrisons: 1.18, names: ["atum", "tuna", "thon"] },
            
            // Gr√£os e Massas
            "arroz": { asda: 1.20, tesco: 1.25, sainsburys: 1.22, morrisons: 1.18, names: ["arroz", "rice", "riz"] },
            "macarr√£o": { asda: 0.80, tesco: 0.85, sainsburys: 0.82, morrisons: 0.78, names: ["macarr√£o", "pasta", "p√¢tes"] },
            "feij√£o": { asda: 0.90, tesco: 0.95, sainsburys: 0.92, morrisons: 0.88, names: ["feij√£o", "beans", "haricots"] },
            "lentilha": { asda: 1.10, tesco: 1.15, sainsburys: 1.12, morrisons: 1.08, names: ["lentilha", "lentils", "lentilles"] },
            
            // Vegetais
            "batata": { asda: 1.50, tesco: 1.55, sainsburys: 1.52, morrisons: 1.48, names: ["batata", "potato", "pomme de terre"] },
            "tomate": { asda: 1.80, tesco: 1.85, sainsburys: 1.82, morrisons: 1.78, names: ["tomate", "tomato", "tomate"] },
            "cebola": { asda: 0.60, tesco: 0.65, sainsburys: 0.62, morrisons: 0.58, names: ["cebola", "onion", "oignon"] },
            "alho": { asda: 0.40, tesco: 0.45, sainsburys: 0.42, morrisons: 0.38, names: ["alho", "garlic", "ail"] },
            "cenoura": { asda: 0.70, tesco: 0.75, sainsburys: 0.72, morrisons: 0.68, names: ["cenoura", "carrot", "carotte"] },
            "alface": { asda: 0.50, tesco: 0.55, sainsburys: 0.52, morrisons: 0.48, names: ["alface", "lettuce", "laitue"] },
            "espinafre": { asda: 1.20, tesco: 1.25, sainsburys: 1.22, morrisons: 1.18, names: ["espinafre", "spinach", "√©pinards"] },
            "br√≥colis": { asda: 1.40, tesco: 1.45, sainsburys: 1.42, morrisons: 1.38, names: ["br√≥colis", "broccoli", "brocoli"] },
            "piment√£o": { asda: 1.60, tesco: 1.65, sainsburys: 1.62, morrisons: 1.58, names: ["piment√£o", "pepper", "poivron"] },
            "cogumelo": { asda: 1.80, tesco: 1.85, sainsburys: 1.82, morrisons: 1.78, names: ["cogumelo", "mushroom", "champignon"] },
            
            // Frutas
            "banana": { asda: 0.80, tesco: 0.85, sainsburys: 0.82, morrisons: 0.78, names: ["banana", "banana", "banane"] },
            "ma√ß√£": { asda: 1.20, tesco: 1.25, sainsburys: 1.22, morrisons: 1.18, names: ["ma√ß√£", "apple", "pomme"] },
            "laranja": { asda: 1.00, tesco: 1.05, sainsburys: 1.02, morrisons: 0.98, names: ["laranja", "orange", "orange"] },
            "uva": { asda: 2.50, tesco: 2.60, sainsburys: 2.55, morrisons: 2.48, names: ["uva", "grapes", "raisins"] },
            "morango": { asda: 2.20, tesco: 2.30, sainsburys: 2.25, morrisons: 2.18, names: ["morango", "strawberry", "fraise"] },
            "lim√£o": { asda: 0.60, tesco: 0.65, sainsburys: 0.62, morrisons: 0.58, names: ["lim√£o", "lemon", "citron"] },
            "abacate": { asda: 1.80, tesco: 1.85, sainsburys: 1.82, morrisons: 1.78, names: ["abacate", "avocado", "avocat"] },
            
            // Temperos e Condimentos
            "a√ß√∫car": { asda: 0.65, tesco: 0.70, sainsburys: 0.67, morrisons: 0.63, names: ["a√ß√∫car", "sugar", "sucre"] },
            "sal": { asda: 0.30, tesco: 0.35, sainsburys: 0.32, morrisons: 0.28, names: ["sal", "salt", "sel"] },
            "pimenta": { asda: 1.20, tesco: 1.25, sainsburys: 1.22, morrisons: 1.18, names: ["pimenta", "pepper", "poivre"] },
            "√≥leo": { asda: 1.80, tesco: 1.85, sainsburys: 1.82, morrisons: 1.78, names: ["√≥leo", "oil", "huile"] },
            "azeite": { asda: 3.50, tesco: 3.60, sainsburys: 3.55, morrisons: 3.45, names: ["azeite", "olive oil", "huile d'olive"] },
            "vinagre": { asda: 0.80, tesco: 0.85, sainsburys: 0.82, morrisons: 0.78, names: ["vinagre", "vinegar", "vinaigre"] },
            "ketchup": { asda: 1.20, tesco: 1.25, sainsburys: 1.22, morrisons: 1.18, names: ["ketchup", "ketchup", "ketchup"] },
            "mostarda": { asda: 1.00, tesco: 1.05, sainsburys: 1.02, morrisons: 0.98, names: ["mostarda", "mustard", "moutarde"] },
            "maionese": { asda: 1.50, tesco: 1.55, sainsburys: 1.52, morrisons: 1.48, names: ["maionese", "mayonnaise", "mayonnaise"] },
            
            // Bebidas
            "√°gua": { asda: 0.50, tesco: 0.55, sainsburys: 0.52, morrisons: 0.48, names: ["√°gua", "water", "eau"] },
            "suco": { asda: 1.20, tesco: 1.25, sainsburys: 1.22, morrisons: 1.18, names: ["suco", "juice", "jus"] },
            "caf√©": { asda: 3.50, tesco: 3.60, sainsburys: 3.55, morrisons: 3.45, names: ["caf√©", "coffee", "caf√©"] },
            "ch√°": { asda: 2.20, tesco: 2.30, sainsburys: 2.25, morrisons: 2.18, names: ["ch√°", "tea", "th√©"] },
            "cerveja": { asda: 1.20, tesco: 1.25, sainsburys: 1.22, morrisons: 1.18, names: ["cerveja", "beer", "bi√®re"] },
            "vinho": { asda: 5.50, tesco: 5.60, sainsburys: 5.55, morrisons: 5.45, names: ["vinho", "wine", "vin"] },
            
            // Snacks e Doces
            "chocolate": { asda: 2.50, tesco: 2.60, sainsburys: 2.55, morrisons: 2.48, names: ["chocolate", "chocolate", "chocolat"] },
            "biscoito": { asda: 1.80, tesco: 1.85, sainsburys: 1.82, morrisons: 1.78, names: ["biscoito", "cookies", "biscuits"] },
            "bolacha": { asda: 1.50, tesco: 1.55, sainsburys: 1.52, morrisons: 1.48, names: ["bolacha", "crackers", "crackers"] },
            "pipoca": { asda: 1.20, tesco: 1.25, sainsburys: 1.22, morrisons: 1.18, names: ["pipoca", "popcorn", "popcorn"] },
            "gelado": { asda: 3.50, tesco: 3.60, sainsburys: 3.55, morrisons: 3.45, names: ["gelado", "ice cream", "glace"] },
            
            // Produtos de Limpeza
            "sab√£o": { asda: 1.20, tesco: 1.25, sainsburys: 1.22, morrisons: 1.18, names: ["sab√£o", "soap", "savon"] },
            "shampoo": { asda: 2.50, tesco: 2.60, sainsburys: 2.55, morrisons: 2.48, names: ["shampoo", "shampoo", "shampooing"] },
            "papel": { asda: 4.50, tesco: 4.60, sainsburys: 4.55, morrisons: 4.45, names: ["papel", "toilet paper", "papier toilette"] },
            "detergente": { asda: 1.80, tesco: 1.85, sainsburys: 1.82, morrisons: 1.78, names: ["detergente", "detergent", "d√©tergent"] }
        };
        
        function searchPrices(itemName) {
            const resultsDiv = document.getElementById("priceResults");
            const normalizedName = itemName.toLowerCase().trim();
            
            // Buscar no banco de dados com m√∫ltiplos idiomas
            let foundPrices = null;
            let foundKey = null;
            
            for (const [key, data] of Object.entries(priceDatabase)) {
                // Verificar se o nome digitado corresponde a algum dos nomes do produto
                if (data.names && data.names.some(name => 
                    normalizedName.includes(name.toLowerCase()) || 
                    name.toLowerCase().includes(normalizedName)
                )) {
                    foundPrices = data;
                    foundKey = key;
                    break;
                }
                
                // Fallback: busca simples por palavra-chave
                if (normalizedName.includes(key) || key.includes(normalizedName)) {
                    foundPrices = data;
                    foundKey = key;
                    break;
                }
            }
            
            if (foundPrices) {
                // Mostrar pre√ßos encontrados
                let html = `<h4>‚úÖ Produto encontrado: ${foundKey}</h4>`;
                for (const [store, price] of Object.entries(foundPrices)) {
                    if (store !== 'names') { // Pular o campo 'names'
                        html += `
                            <div class="price-item">
                                <span class="price-store">${store.charAt(0).toUpperCase() + store.slice(1)}</span>
                                <span class="price-value">¬£${price.toFixed(2)}</span>
                            </div>
                        `;
                    }
                }
                
                // Calcular pre√ßo m√©dio (excluindo o campo 'names')
                const prices = Object.entries(foundPrices)
                    .filter(([key]) => key !== 'names')
                    .map(([, price]) => price);
                const averagePrice = prices.reduce((sum, price) => sum + price, 0) / prices.length;
                
                html += `
                    <div class="price-item" style="border-top: 2px solid #4CAF50; margin-top: 10px; padding-top: 10px;">
                        <span class="price-store" style="color: #4CAF50;">üí∞ Pre√ßo M√©dio</span>
                        <span class="price-value" style="color: #4CAF50; font-weight: bold;">¬£${averagePrice.toFixed(2)}</span>
                    </div>
                `;
                
                resultsDiv.innerHTML = html;
                resultsDiv.style.display = 'block';
                
                // Preencher automaticamente o campo de pre√ßo com o valor m√©dio
                document.getElementById("priceInput").value = averagePrice.toFixed(2);
                
                showNotification(`‚úÖ ${foundKey} encontrado! Pre√ßo m√©dio: ¬£${averagePrice.toFixed(2)}`, "success");
            } else {
                // N√£o encontrou pre√ßos espec√≠ficos
                resultsDiv.innerHTML = `
                    <h4>Pre√ßos n√£o encontrados</h4>
                    <p>Produto n√£o encontrado no banco de dados.</p>
                    <p><strong>Sugest√µes:</strong></p>
                    <ul style="text-align: left; margin: 10px 0;">
                        <li>Digite o pre√ßo manualmente</li>
                        <li>Verifique a ortografia</li>
                        <li>Use termos mais gen√©ricos (ex: "leite" em vez de "leite desnatado")</li>
                    </ul>
                    <p><strong>Links √∫teis:</strong></p>
                    <div style="margin-top: 10px;">
                        <a href="https://groceries.asda.com/search/${encodeURIComponent(itemName)}" target="_blank" style="color: #4CAF50; margin-right: 15px;">üîç ASDA</a>
                        <a href="https://www.tesco.com/groceries/en-GB/search?query=${encodeURIComponent(itemName)}" target="_blank" style="color: #4CAF50; margin-right: 15px;">üîç Tesco</a>
                        <a href="https://www.sainsburys.co.uk/gol-ui/SearchDisplayView?catalogId=10123&storeId=10151&langId=44&searchTerm=${encodeURIComponent(itemName)}" target="_blank" style="color: #4CAF50;">üîç Sainsbury's</a>
                    </div>
                `;
                resultsDiv.style.display = 'block';
                showNotification("Produto n√£o encontrado. Links para busca manual fornecidos.", "info");
            }
        }
        
        // Fun√ß√£o para busca autom√°tica de pre√ßos
        function autoSearchPrice(itemName) {
            const normalizedName = itemName.toLowerCase().trim();
            
            // Buscar no banco de dados com m√∫ltiplos idiomas
            let foundPrices = null;
            let foundKey = null;
            
            for (const [key, data] of Object.entries(priceDatabase)) {
                // Verificar se o nome digitado corresponde a algum dos nomes do produto
                if (data.names && data.names.some(name => 
                    normalizedName.includes(name.toLowerCase()) || 
                    name.toLowerCase().includes(normalizedName)
                )) {
                    foundPrices = data;
                    foundKey = key;
                    break;
                }
                
                // Fallback: busca simples por palavra-chave
                if (normalizedName.includes(key) || key.includes(normalizedName)) {
                    foundPrices = data;
                    foundKey = key;
                    break;
                }
            }
            
            if (foundPrices) {
                // Calcular pre√ßo m√©dio (excluindo o campo 'names')
                const prices = Object.entries(foundPrices)
                    .filter(([key]) => key !== 'names')
                    .map(([, price]) => price);
                const averagePrice = prices.reduce((sum, price) => sum + price, 0) / prices.length;
                
                // Preencher automaticamente o campo de pre√ßo
                document.getElementById("priceInput").value = averagePrice.toFixed(2);
                
                // Mostrar notifica√ß√£o discreta
                showNotification(`üí∞ ${foundKey}: ¬£${averagePrice.toFixed(2)}`, "success");
            }
        }
        
        // Fun√ß√£o para inicializar sess√£o √∫nica
        function initializeSession() {
            // Verificar se j√° existe uma sess√£o
            let existingSession = sessionStorage.getItem('shoppingSessionId');
            
            if (existingSession) {
                sessionId = existingSession;
            } else {
                // Criar nova sess√£o √∫nica
                sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                sessionStorage.setItem('shoppingSessionId', sessionId);
            }
            
            // Mostrar ID da sess√£o (primeiros 8 caracteres)
            document.getElementById('sessionId').textContent = sessionId.substr(0, 8) + '...';
            
            console.log('Sess√£o inicializada:', sessionId);
        }
        
        // Fun√ß√£o para limpar todos os dados
        function clearAllData() {
            try {
                // Limpar lista atual
                shoppingList = [];
                
                // Limpar localStorage da sess√£o
                const key = `shoppingList_${sessionId}`;
                localStorage.removeItem(key);
                
                // Limpar sessionStorage
                sessionStorage.removeItem('shoppingSessionId');
                
                // Limpar resultados de pre√ßos
                document.getElementById('priceResults').style.display = 'none';
                document.getElementById('priceResults').innerHTML = '';
                
                // Atualizar interface
                renderList();
                updateStats();
                
                // Criar nova sess√£o
                initializeSession();
                
                showNotification("Lista limpa com sucesso! Nova sess√£o criada.", "success");
                
            } catch (error) {
                console.error("Erro ao limpar dados:", error);
                showNotification("Erro ao limpar dados", "error");
            }
        }
        
        // Fun√ß√£o para mostrar informa√ß√µes da sess√£o
        function showSessionInfo() {
            const info = `
                Sess√£o: ${sessionId}
                Itens salvos: ${shoppingList.length}
                Total estimado: ¬£${shoppingList.reduce((sum, item) => sum + (item.price || 0), 0).toFixed(2)}
            `;
            alert(info);
        }
    </script>
</body>
</html>' > lista-compras-completa.html
